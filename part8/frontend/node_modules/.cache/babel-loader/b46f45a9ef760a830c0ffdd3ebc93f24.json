{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { mergeOptions } from \"../../utilities/index.js\";\nimport { useInternalState } from \"./useQuery.js\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nvar EAGER_METHODS = ['refetch', 'reobserve', 'fetchMore', 'updateQuery', 'startPolling', 'subscribeToMore'];\nexport function useLazyQuery(query, options) {\n  var abortControllersRef = useRef(new Set());\n  var internalState = useInternalState(useApolloClient(options && options.client), query);\n  var execOptionsRef = useRef();\n  var merged = execOptionsRef.current ? mergeOptions(options, execOptionsRef.current) : options;\n  var useQueryResult = internalState.useQuery(__assign(__assign({}, merged), {\n    skip: !execOptionsRef.current\n  }));\n  var initialFetchPolicy = useQueryResult.observable.options.initialFetchPolicy || internalState.getDefaultFetchPolicy();\n  var result = Object.assign(useQueryResult, {\n    called: !!execOptionsRef.current\n  });\n  var eagerMethods = useMemo(function () {\n    var eagerMethods = {};\n\n    var _loop_1 = function (key) {\n      var method = result[key];\n\n      eagerMethods[key] = function () {\n        if (!execOptionsRef.current) {\n          execOptionsRef.current = Object.create(null);\n          internalState.forceUpdate();\n        }\n\n        return method.apply(this, arguments);\n      };\n    };\n\n    for (var _i = 0, EAGER_METHODS_1 = EAGER_METHODS; _i < EAGER_METHODS_1.length; _i++) {\n      var key = EAGER_METHODS_1[_i];\n\n      _loop_1(key);\n    }\n\n    return eagerMethods;\n  }, []);\n  Object.assign(result, eagerMethods);\n  useEffect(function () {\n    return function () {\n      abortControllersRef.current.forEach(function (controller) {\n        controller.abort();\n      });\n    };\n  }, []);\n  var execute = useCallback(function (executeOptions) {\n    var controller = new AbortController();\n    abortControllersRef.current.add(controller);\n    execOptionsRef.current = executeOptions ? __assign(__assign({}, executeOptions), {\n      fetchPolicy: executeOptions.fetchPolicy || initialFetchPolicy\n    }) : {\n      fetchPolicy: initialFetchPolicy\n    };\n    var promise = internalState.asyncUpdate(controller.signal).then(function (queryResult) {\n      abortControllersRef.current.delete(controller);\n      return Object.assign(queryResult, eagerMethods);\n    });\n    promise.catch(function () {\n      abortControllersRef.current.delete(controller);\n    });\n    return promise;\n  }, []);\n  return [execute, result];\n}","map":{"version":3,"mappings":"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","names":["useCallback","useEffect","useMemo","useRef","mergeOptions","useInternalState","useApolloClient","EAGER_METHODS","useLazyQuery","query","options","abortControllersRef","Set","internalState","client","execOptionsRef","merged","current","useQueryResult","useQuery","__assign","skip","initialFetchPolicy","observable","getDefaultFetchPolicy","result","Object","assign","called","eagerMethods","key","method","create","forceUpdate","apply","arguments","_i","forEach","controller","abort","execute","AbortController","add","executeOptions","fetchPolicy","promise","asyncUpdate","signal","then","delete","queryResult","catch"],"sources":["/home/agustin/Documents/GitHub/fullstackOpen22/part8/frontend/node_modules/@apollo/src/react/hooks/useLazyQuery.ts"],"sourcesContent":["import { DocumentNode } from 'graphql';\nimport { TypedDocumentNode } from '@graphql-typed-document-node/core';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\n\nimport { OperationVariables } from '../../core';\nimport { mergeOptions } from '../../utilities';\nimport {\n  LazyQueryHookOptions,\n  LazyQueryResultTuple,\n  QueryResult,\n} from '../types/types';\nimport { useInternalState } from './useQuery';\nimport { useApolloClient } from './useApolloClient';\n\n// The following methods, when called will execute the query, regardless of\n// whether the useLazyQuery execute function was called before.\nconst EAGER_METHODS = [\n  'refetch',\n  'reobserve',\n  'fetchMore',\n  'updateQuery',\n  'startPolling',\n  'subscribeToMore',\n] as const;\n\nexport function useLazyQuery<TData = any, TVariables = OperationVariables>(\n  query: DocumentNode | TypedDocumentNode<TData, TVariables>,\n  options?: LazyQueryHookOptions<TData, TVariables>\n): LazyQueryResultTuple<TData, TVariables> {\n  const abortControllersRef = useRef(new Set<AbortController>());\n  const internalState = useInternalState(\n    useApolloClient(options && options.client),\n    query,\n  );\n\n  const execOptionsRef = useRef<Partial<LazyQueryHookOptions<TData, TVariables>>>();\n  const merged = execOptionsRef.current\n    ? mergeOptions(options, execOptionsRef.current)\n    : options;\n\n  const useQueryResult = internalState.useQuery({\n    ...merged,\n    skip: !execOptionsRef.current,\n  });\n\n  const initialFetchPolicy =\n    useQueryResult.observable.options.initialFetchPolicy ||\n    internalState.getDefaultFetchPolicy();\n\n  const result: QueryResult<TData, TVariables> =\n    Object.assign(useQueryResult, {\n      called: !!execOptionsRef.current,\n    });\n\n  // We use useMemo here to make sure the eager methods have a stable identity.\n  const eagerMethods = useMemo(() => {\n    const eagerMethods: Record<string, any> = {};\n    for (const key of EAGER_METHODS) {\n      const method = result[key];\n      eagerMethods[key] = function () {\n        if (!execOptionsRef.current) {\n          execOptionsRef.current = Object.create(null);\n          // Only the first time populating execOptionsRef.current matters here.\n          internalState.forceUpdate();\n        }\n        return method.apply(this, arguments);\n      };\n    }\n\n    return eagerMethods;\n  }, []);\n\n  Object.assign(result, eagerMethods);\n\n  useEffect(() => {\n    return () => {\n      abortControllersRef.current.forEach((controller) => {\n        controller.abort();\n      });\n    }\n  }, [])\n\n  const execute = useCallback<\n    LazyQueryResultTuple<TData, TVariables>[0]\n  >(executeOptions => {\n    const controller = new AbortController();\n    abortControllersRef.current.add(controller);\n\n    execOptionsRef.current = executeOptions ? {\n      ...executeOptions,\n      fetchPolicy: executeOptions.fetchPolicy || initialFetchPolicy,\n    } : {\n      fetchPolicy: initialFetchPolicy,\n    };\n\n    const promise = internalState\n      .asyncUpdate(controller.signal) // Like internalState.forceUpdate, but returns a Promise.\n      .then(queryResult => {\n        abortControllersRef.current.delete(controller);\n\n        return Object.assign(queryResult, eagerMethods);\n      });\n\n    promise.catch(() => {\n      abortControllersRef.current.delete(controller);\n    });\n\n    return promise;\n  }, []);\n\n  return [execute, result];\n}\n"]},"metadata":{},"sourceType":"module"}